<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QuickBus - Book Bus Tickets</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        /* Base Styles */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: #f5f5f5;
        }

        /* Search Container */
        .search-container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 2rem;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 15px rgba(0,0,0,0.1);
        }

        .search-form {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }

        .form-group {
            position: relative;
        }

        input, select {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }

        .search-btn {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.3s;
        }

        /* Seat Selection */
        .seat-map {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            max-width: 600px;
            margin: 2rem auto;
        }

        .seat {
            width: 50px;
            height: 50px;
            background: #27ae60;
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .seat.selected {
            background: #e74c3c;
        }

        .seat.occupied {
            background: #7f8c8d;
            cursor: not-allowed;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .search-form {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <?php include('header.php'); ?>

    <!-- Main Search Section -->
    <div class="search-container">
        <form action="search.php" method="POST" class="search-form">
            <div class="form-group">
                <label>From</label>
                <select name="from" required>
                    <option value="">Select pickup</option>
                    <?php
                    // PHP code to fetch locations from database
                    $locations = get_locations();
                    foreach ($locations as $location) {
                        echo "<option value='{$location['id']}'>{$location['name']}</option>";
                    }
                    ?>
                </select>
            </div>
            
            <div class="form-group">
                <label>To</label>
                <select name="to" required>
                    <!-- Similar options for destinations -->
                </select>
            </div>

            <div class="form-group">
                <label>Travel Date</label>
                <input type="date" name="date" required>
            </div>

            <button type="submit" class="search-btn">Search Buses</button>
        </form>
    </div>

    <!-- Seat Selection Page -->
    <div class="seat-selection" style="display: none;">
        <h3>Select Your Seat</h3>
        <div class="seat-map" id="seatMap">
            <!-- JavaScript will populate seats -->
        </div>
        <button onclick="confirmBooking()">Confirm Selection</button>
    </div>

    <?php include('footer.php'); ?>

    <script>
        // Seat Selection Logic
        let selectedSeat = null;

        function generateSeatMap() {
            const seatMap = document.getElementById('seatMap');
            for (let i = 1; i <= 47; i++) {
                const seat = document.createElement('div');
                seat.className = `seat ${Math.random() < 0.3 ? 'occupied' : ''}`;
                seat.textContent = i;
                if (!seat.classList.contains('occupied')) {
                    seat.addEventListener('click', () => selectSeat(i));
                }
                seatMap.appendChild(seat);
            }
        }

        function selectSeat(seatNumber) {
            if (selectedSeat) {
                selectedSeat.classList.remove('selected');
            }
            selectedSeat = event.target;
            selectedSeat.classList.add('selected');
            document.getElementById('selectedSeat').value = seatNumber;
        }

        function confirmBooking() {
            if (!selectedSeat) {
                alert('Please select a seat');
                return;
            }
            // Proceed to payment
            window.location.href = 'payment.php';
        }

        // Initialize on page load
        window.onload = generateSeatMap;
    </script>
</body>
</html>
<?php
// Database connection
$servername = "localhost";
$username = "username";
$password = "password";
$dbname = "bus_booking";

$conn = new mysqli($servername, $username, $password, $dbname);

// Search functionality
if ($_SERVER["REQUEST_METHOD"] == "POST") {
    $from = $_POST['from'];
    $to = $_POST['to'];
    $date = $_POST['date'];
    
    $sql = "SELECT * FROM buses 
            WHERE route_from = ? 
            AND route_to = ? 
            AND travel_date = ?";
    
    $stmt = $conn->prepare($sql);
    $stmt->bind_param("iis", $from, $to, $date);
    $stmt->execute();
    $result = $stmt->get_result();
    
    // Display results
    while($row = $result->fetch_assoc()) {
        echo "<div class='bus-result'>";
        echo "<h3>{$row['bus_name']}</h3>";
        echo "<p>Departure: {$row['departure_time']}</p>";
        echo "<p>Seats Available: {$row['available_seats']}</p>";
        echo "<button onclick='selectBus({$row['id']})'>Select</button>";
        echo "</div>";
    }
}
?>

CREATE TABLE buses (
    id INT PRIMARY KEY AUTO_INCREMENT,
    bus_name VARCHAR(255),
    route_from INT,
    route_to INT,
    travel_date DATE,
    departure_time TIME,
    fare DECIMAL(10,2),
    available_seats INT
);

CREATE TABLE locations (
    id INT PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(255),
    address TEXT
);

CREATE TABLE bookings (
    id INT PRIMARY KEY AUTO_INCREMENT,
    user_id INT,
    bus_id INT,
    seat_number INT,
    booking_date DATETIME,
    status ENUM('confirmed', 'pending', 'cancelled')
);

<?php
session_start();
// Implement PayPal/Razorpay integration here
?>
<div class="payment-container">
    <h2>Payment Gateway Integration</h2>
    <!-- Add payment gateway SDK -->
    <div id="payment-form"></div>
</div>

<style>
/* Mobile Navigation */
.hamburger-menu {
    display: none;
}

@media (max-width: 768px) {
    .nav-links {
        display: none;
    }
    .hamburger-menu {
        display: block;
    }
}

/* Card Layout */
.bus-result {
    background: white;
    padding: 1rem;
    margin: 1rem 0;
    border-radius: 8px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
}
</style>

<?php
use PHPMailer\PHPMailer\PHPMailer;

function sendBookingConfirmation($email, $booking_details) {
    $mail = new PHPMailer(true);
    
    // SMTP Configuration
    $mail->isSMTP();
    $mail->Host = 'smtp.example.com';
    $mail->SMTPAuth = true;
    $mail->Username = 'your@email.com';
    $mail->Password = 'password';
    $mail->SMTPSecure = 'tls';
    $mail->Port = 587;

    // Email content
    $mail->setFrom('noreply@quickbus.com');
    $mail->addAddress($email);
    $mail->isHTML(true);
    $mail->Subject = 'Booking Confirmation';
    $mail->Body = generateEmailTemplate($booking_details);

    $mail->send();
}
?>

